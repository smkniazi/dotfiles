#!/bin/bash
user=hop
password=hop

if [ "$#" -ne 1 ]; then
  database="hops"
else
  database=$1;
fi

echo "Using Database $database"

mysql="mysql -u$user -p$password --protocol=TCP "

set -x
#set -e

echo "Dropping Schema" 
eval "$mysql -e 'DROP DATABASE IF EXISTS $database'"

echo "Creating Schema" 
eval "$mysql -e 'CREATE DATABASE $database'"

echo "Dropping and Recreating disk table data files" 
eval "$mysql -e 'ALTER TABLESPACE ts_1 drop datafile \"ts_1_data_file_0.dat\" ENGINE ndbcluster'"
eval "$mysql -e 'DROP TABLESPACE ts_1 ENGINE ndbcluster'"
eval "$mysql -e 'DROP LOGFILE GROUP lg_1 ENGINE ndbcluster'"



echo "Applying Schema updates" 
cd ~/code/hops/hops-metadata-dal-impl-ndb/schema
./create-tables.sh 127.0.0.1 3306 hop hop $database
